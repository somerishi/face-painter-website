---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allGalleries = await getCollection('galleries');
const categories = ['all', 'kids-parties', 'corporate-events', 'festivals', 'weddings', 'other'];
---

<BaseLayout title="Gallery - Rainbow Faces">
  <section class="py-20">
    <div class="container mx-auto px-6">
      <h1 class="font-display text-5xl md:text-6xl text-center gradient-text mb-4">Our Gallery</h1>
      <p class="text-center text-gray-600 mb-12 text-lg max-w-2xl mx-auto">
        Browse through our collection of face painting designs organized by event type
      </p>

      <!-- Category Filter -->
      <div class="flex flex-wrap justify-center gap-4 mb-12" id="category-filter">
        {categories.map((category) => (
          <button
            data-category={category}
            class="category-btn px-6 py-2 font-heading font-semibold rounded-full transition-all duration-300 border-2"
            class:list={[
              category === 'all' ? 'bg-primary-pink text-white border-primary-pink' : 'border-gray-300 hover:border-primary-pink'
            ]}
          >
            {category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}
          </button>
        ))}
      </div>

      <!-- Gallery Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="gallery-grid">
        {allGalleries.map((gallery) => (
          <a 
            href={`/gallery/${gallery.id}`} 
            class="card group gallery-item"
            data-category={gallery.data.category}
          >
            <div class="aspect-square overflow-hidden">
              <img 
                src={gallery.data.coverImage} 
                alt={gallery.data.title}
                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
              />
            </div>
            <div class="p-6">
              <span class="inline-block px-3 py-1 text-xs font-semibold bg-primary-pink/20 text-primary-pink rounded-full mb-2">
                {gallery.data.category.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}
              </span>
              <h3 class="font-heading text-xl mb-2 group-hover:text-primary-pink transition-colors">
                {gallery.data.title}
              </h3>
              <p class="text-gray-600 text-sm line-clamp-2">{gallery.data.description}</p>
              <time class="text-xs text-gray-500 mt-2 block">
                {gallery.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long' })}
              </time>
            </div>
          </a>
        ))}
      </div>

      {allGalleries.length === 0 && (
        <div class="text-center py-20">
          <p class="text-xl text-gray-500">No galleries yet. Check back soon!</p>
        </div>
      )}
    </div>
  </section>

  <script>
    // Category filtering
    const filterButtons = document.querySelectorAll('.category-btn');
    const galleryItems = document.querySelectorAll('.gallery-item');

    filterButtons.forEach(button => {
      button.addEventListener('click', () => {
        const category = button.getAttribute('data-category');
        
        // Update active button
        filterButtons.forEach(btn => {
          btn.classList.remove('bg-primary-pink', 'text-white', 'border-primary-pink');
          btn.classList.add('border-gray-300');
        });
        button.classList.add('bg-primary-pink', 'text-white', 'border-primary-pink');
        button.classList.remove('border-gray-300');

        // Filter gallery items
        galleryItems.forEach(item => {
          const itemCategory = item.getAttribute('data-category');
          if (category === 'all' || itemCategory === category) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });
      });
    });
  </script>

  <style>
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</BaseLayout>
